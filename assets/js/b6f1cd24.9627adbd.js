(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[642],{9518:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},metadata:function(){return r},toc:function(){return d},default:function(){return p}});var o=n(2122),a=n(9756),i=(n(7294),n(3905)),l=["components"],s={sidebar_position:8},r={unversionedId:"core/little-o",id:"core/little-o",isDocsHomePage:!1,title:"Little o",description:"Big O felt lonely, so he decided he wanted a Little o to keep him company. Unlike his big brother, Little o isn't just a pretty face, he's actually pretty darn important!",source:"@site/docs/core/little-o.md",sourceDirName:"core",slug:"/core/little-o",permalink:"/oblong/docs/core/little-o",editUrl:"https://github.com/travislwatson/oblong/edit/master/website/docs/core/little-o.md",version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Big O",permalink:"/oblong/docs/core/big-o"},next:{title:"Click Game",permalink:"/oblong/docs/examples/click-game"}},d=[{value:"The Idea",id:"the-idea",children:[]},{value:"How it Works",id:"how-it-works",children:[]},{value:"Why Little o is Important",id:"why-little-o-is-important",children:[]},{value:"The Only Downside",id:"the-only-downside",children:[]},{value:"Okay, So Why the Letter o?",id:"okay-so-why-the-letter-o",children:[]}],u={toc:d};function p(e){var t=e.components,n=(0,a.Z)(e,l);return(0,i.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Big O felt lonely, so he decided he wanted a Little o to keep him company. Unlike his big brother, Little o isn't just a pretty face, he's actually pretty darn important!"),(0,i.kt)("h2",{id:"the-idea"},"The Idea"),(0,i.kt)("p",null,"Oblong's dependency injection is unusual in that it is ",(0,i.kt)("em",{parentName:"p"},"live"),". Within a given injection context, the values always reflect what is in the store."),(0,i.kt)("p",null,"An example will help:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"// Let's start at the age of 17\nconst age = O.state('age').as(17)\n\n// And some legal limit is defined at 18\nconst isLegal = O.query()\n  .with({ age })\n  .as((o) => o.age >= 18)\n\nconst test = O.command()\n  .with({ age, isLegal })\n  .as((o) => {\n    // Initial calculations are as you'd expect\n    console.log(o.age) // 17\n    console.log(o.isLegal) // false\n\n    // Here we perform our mutation, and the Redux tree changes\n    o.age = 18\n\n    // Not only is the age updated like you'd expect, but the query is recalculated\n    console.log(o.age) // 18\n    console.log(o.isLegal) // true\n  })\n")),(0,i.kt)("p",null,"You can see here that both the ",(0,i.kt)("inlineCode",{parentName:"p"},"o.age")," state and ",(0,i.kt)("inlineCode",{parentName:"p"},"o.isLegal")," query updated and were correct, mid command! Little o is how we make that happen. \ud83d\udcaa"),(0,i.kt)("h2",{id:"how-it-works"},"How it Works"),(0,i.kt)("p",null,"Dependency Injection in Oblong is done through ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty"},(0,i.kt)("inlineCode",{parentName:"a"},"defineProperty")),". This means we have a ",(0,i.kt)("inlineCode",{parentName:"p"},"get")," and a ",(0,i.kt)("inlineCode",{parentName:"p"},"set")," function available for every dependency. The setter is used for state assignments, but the getter is where this DI implementation really shines!"),(0,i.kt)("p",null,"If you're familiar with thunks, you have probably seen something like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"const age = getAge(getState())\n")),(0,i.kt)("p",null,"The selector is given the current state value in order to materialize the result. In Oblong, our property definition does this lookup in the getter instead:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"Object.defineProperty(o, 'age', {\n  get() {\n    return getAge(store.getState())\n  },\n})\n")),(0,i.kt)("p",null,"It's always live every time you access it, with zero code overhead. Neat!"),(0,i.kt)("h2",{id:"why-little-o-is-important"},"Why Little o is Important"),(0,i.kt)("p",null,"Oblong's way of keeping values live means it behaves as you intuitively expect. Unless you don't use Little o. Example time!"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"const age = o.age\nconsole.log(age) // 17\nconsole.log(o.age) // 17\n\no.age = 18\n\nconsole.log(age) // 17\nconsole.log(o.age) // 18\n\nage = 18 // Error\n")),(0,i.kt)("p",null,"You can see that as soon as we materialize and store the state value, it won't update any more. And assignment doesn't work. This is almost definitely not what you want. We don't have a way to stop you, but please don't materialize your dependencies!"),(0,i.kt)("h2",{id:"the-only-downside"},"The Only Downside"),(0,i.kt)("p",null,'At this point you might be thinking "okay, wonderful. Little o notation is easier, shorter, and just works. What\'s the catch?"'),(0,i.kt)("p",null,"The catch is you can't use destructuring. And that's a bummer, because destructuring is cool."),(0,i.kt)("p",null,"Whatever you do, ",(0,i.kt)("strong",{parentName:"p"},"DO NOT DO THIS"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"const test = O.command()\n  .with({ age, isLegal })\n  .as(({ age, isLegal }) => {\n    /* \ud83d\udca3 \ud83d\udca5 \ud83d\udc80 */\n  })\n")),(0,i.kt)("p",null,"Sorry destructuring, we love you, but we need our property descriptors!"),(0,i.kt)("h2",{id:"okay-so-why-the-letter-o"},"Okay, So Why the Letter o?"),(0,i.kt)("p",null,"It's just an arbitrary argument name, you can use whatever you'd like. ",(0,i.kt)("inlineCode",{parentName:"p"},"o")," seemed cute, short, and easy to type, right beside our trusty friend ",(0,i.kt)("inlineCode",{parentName:"p"},"i"),". Many common examples of defining arbitrary objects use ",(0,i.kt)("inlineCode",{parentName:"p"},"o")," including the MDN documentation for defineProperty. But if it really bothers you..."),(0,i.kt)("p",null,"If you're the explicit type of person, maybe use ",(0,i.kt)("inlineCode",{parentName:"p"},"(dependencies) =>"),"."),(0,i.kt)("p",null,"If you're explicit, but busy, maybe ",(0,i.kt)("inlineCode",{parentName:"p"},"(deps) =>"),"."),(0,i.kt)("p",null,"If you're feeling retro, how about ",(0,i.kt)("inlineCode",{parentName:"p"},"($) =>"),"."),(0,i.kt)("p",null,"If you like chaos, might I suggest ",(0,i.kt)("inlineCode",{parentName:"p"},"(_) =>"),"."),(0,i.kt)("p",null,"Or just realize it doesn't matter, and accept that Big O needed a buddy, and Little o saved the day."))}p.isMDXComponent=!0}}]);